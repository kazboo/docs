# 3. 早まった安易な最適化

* Donald Knuth(ドナルド・クヌース)
  * 「早まった最適化」という語の考案者

* 早まった最適化(Premature optimization)
  * 以下のような場合に使われる
    * 開発者がコードのパフォーマンスについて気にしていない場合
    * 気にしていてもコードを実行してみるまで実際のパフォーマンスはわからないといった場合
  * 格言「１日のうち９７％くらいは、ささいな効率については忘れるべき」
    * 最終的にはクリーンで率直なコードを記述し、読みやすく理解しやすいようにするべき
  * ここでの最適化
    * アルゴリズムや設計を変更してより良いパフォーマンスを生む代わりに、プログラムの構造を複雑化させてしまうもの
    * 例えばプロファイリングによって大きなメリットが示されるまではしないままでおくべき

* 望ましい最適化
  * パフォーマンスに悪影響を与えるとわかっているコードを避ける

* 全てのコードには複数の選択肢がある
  * これらの選択肢がともにシンプルでわかりやすいのなら、よりパフォーマンスの高いほうを選ぶ
  * 経験を積んだJava経験者はこれを理解しており、時間をかけて理解する点でアートに分類される

* コードの例
  ``` Java
  log.log(Level.FINE, "x = " + calcX() + ", y = " + clacY());
  ```
  * 文字列連結は不要な可能性がある
  * ログレベルがFINE以上でなけれはメッセージが記録されないため
  * 記録されないのでcalcX(), calcY()の呼び出しも無駄になる

* より良いコード
  ``` Java
  if (log.isLoggable(Level.FINE)) {
      log.log(Level.FINE, "x = {}, y = {}", new Object[]{calcX(), clacY()});
  }
  ```
  * 文字列は発生しない(効率的と必ずしも言えないが、クリーンではある)
  * メソッド呼び出しや、配列の生成も行われない

* クリーンなコードは読みやすく容易に理解できる
  * 作成の手間もほとんど変わらない
  * 文字数や行数は若干増えロジックも追加されているが、早まった最適化とは全く性質が異なる
  * よい開発者が当然身につけるべきもの
  * 独断に陥ることなく、自分が作成したコードについて考える時間を用意すべき