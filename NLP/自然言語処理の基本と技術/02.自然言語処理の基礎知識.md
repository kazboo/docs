# 自然言語処理の基礎知識

## 2.1 コーパスと辞書

### コーパス

* `コーパス(Corpus)`
  * 言語の使用方法を記録・蓄積した文書集合

* 均衡コーパス
  * ある言語の使用実態をなるべく忠実に反映するようにバランスよく設計・抽出されたコーパス
  * 代表的なものに、 `BCCWJ(現代日本語書き言葉均衡コーパス)` 、 `Brown Corpus`

* [BCCWJ](http://www.ninjal.ac.jp/corpus_center/bccwj/)

### 辞書

* 辞書
  * 何らかの目的をもって集められた語句のリストの総称
  * [形態素解析用辞書のUniDic](http://sourceforge.jp/projects/unidic/)

* 形態素解析用辞書
  * 日本語に対する「表層形（活用や表記揺れなどを考慮した、文中において文字列として実際に出現する形式）」「原形」「品詞」「読み」などを付与する
  * 日本語テキストを単語に分割し、形態論(ヒトの言語の、語（単語）を構成する仕組み)情報を付与するための辞書

* MRD(Machine Readable Dictionalry, 機械可読辞書)
  * 言語処理分野の辞書の呼称
  * 人間が使う一般的な辞書とは区別される

## 2.2 知識獲得

* 知識獲得
  * 文字列(自然言語で記載された)を処理することで、コンピュータにとって有益な知識の状態にすること

### 語彙の知識

* 語彙の関係
  * 語彙と語彙の関係は、知識獲得を行う上で非常に重要な役割を果たす
  * ある文章と別の文章から、別の文章を推測する時に必要

  |種類|例|説明|
  |:--|:--|:--|
  |異表記|タンパク質と蛋白質など|表記が違うだけで同じ意味の語|
  |同義語|自然言語処理とNLPなど||
  |類義語|家と住宅など||
  |上位下位関係|プードルと犬、犬と動物、動物と生物など||
  |部分全体関係|尻尾とプードルなど||
  |意味カテゴリ関係|アメリカ合衆国、カナダ、メキシコ、北アメリカの国々など|同じ上位語を共有する言葉同士の関係|
  |属性関係|俳優と、その出生地、生年月日、出演作品など||

### 語彙の知識の獲得

* `分布類似度(Distributional Similarity)`
  * 異表記や同義語、上位語や下位語など、意味的に類似している語を同定するためによく使われる概念
  * 「意味の類似している語は、使われる文脈も類似している」という仮説(分布仮説)に基づく
  * 文脈の似ている単語は意味も類似しているとし、同義語や類義語を獲得する考え方

* 以下の表現をみると「」に入る語が、「ワイン」もしくはワインのように「ブドウから作られる酒類の一種」であることが容易に想像がつく
  * 「」のボトルがテーブルに載っている
  * ブドウから作られる「」
  * 昨日、「」を飲みすぎたので二日酔いだ

* `単語のクラスタリング`
  * 「」と「ワイン」のそれぞれの「文脈」を大規模なコーパス等から抽出して、その文脈間の類似度を比べる事で語彙の類似度をある程度推測できる
  * 類似度の近い語同士をまとめれば、意味の近い語のグループを自動的に作成できる

* 2013年ごろから、 `単語のベクトル表現(word representation)` を大規模なテキストから自動的に学習する手法が盛んに研究・応用されてきた
  * その中でも `Skip-gram モデル` は以下から高い人気を博した
    * モデルの単純さ
    * 学習のスピード
    * 学習された後のベクトル表現の質の高さ
    * etc

* `Skip-gram モデル`
  * ニューラルネットワークを使って、ある単語のベクトル表現からその文脈を推定する
  * オープンソース実装( `word2vec` )は手軽さもあって自然言語処理タスクに幅広く応用されてきた
  * word2vecによって学習された単語ベクトルを用いて以下が可能になる
    * 類義語の推定
    * 単語のクラスタリング
    * 意味の類推

* `語彙統語パターン`
  * 上位下位語の抽出でよく使われる考え方
  * 「犬や猫のような動物」といった表現から、犬と猫が動物の下位概念であることを導く手法
    * XやYなどのZ, XやYをはじめとするZ, Xに似たY などの表現パターンをいう
  * HTML等の構造化文書を利用して、語彙の関係を獲得することも可能

### 句・文などの関係性の獲得

* `言い換え`
  * 句や分などの関係において特に重要
  * 意味の等しい言語表現
  * Xの著者はYである と YはXを描いた は、言い換え表現の関係
  * 言い換え表現を利用すれば、分布類似度と同様の考え方で、X,Yに同じような単語の入る表現「XはYによって著された」は言い換え表現である可能性が高いとわかる

* `シソーラス`
  * 自然言語処理における同義語、類義語、上位・下位関係など、単語の意味的な関係を記述した言語資源
  * 有名なものに、プリンストン大学で作られた `WordNet` がある
  * [WordNet](http://www.cs.princeton.edu/courses/archive/spr09/cos226/assignments/wordnet.html)

* `オントロジー`
  * シソーラスと関連の深いもの
  * 概念や物などを意味に従って構造化して整理したデータベース
  * FOAF(Friend of a Friend)
    * 人と人の関係に関する情報を構造化してデータとして表現し、WEB上で公開・共有できるようにしてる
  * セマンティックWeb
    * ウェブページをコンピュータによって意味的に理解可能な形で表現するプロジェクト
  * 代表例：Freebase, DBPedia, YAGO etc

* `知識ベース`
  * オントロジーと似た概念
  * 「知識」を構造化して格納したデータベース

## 2.3 情報抽出

### 情報抽出とは

* 自然言語から「構造化された情報」を抽出する技術

以下は、構造化されていないのでコンピュータで処理できない。

``` example
米アップル社は、9月13日にiPhone5を発売する。価格は32GBモデルが299ドル
```

コンピュータで処理できるのは、以下のような構造化された「製品発売情報」。

``` example
メーカー：米アップル社
製品：iPhone 5
価格：299
日付：9月13日
```

データベースにおけるレコードの形、つまりエンティティ(現実に対応する「モノ」)と属性等がセットになった構造で情報が表現されている状態


### 情報抽出の技術

* 情報抽出の技術
  * `固有表現抽出`
  * `関係抽出`
  * `イベント情報抽出`

#### イベント情報抽出

* 最も典型的な情報抽出のタスク

* 自然言語から、ある出来事の参加者や時間などを抽出する技術

* 新製品発売のニュース文から、メーカー、製品、価格、日付などの情報を抽出し、構造化する

* イベント情報抽出の原理
  * `スロット付きのテンプレート` を用意
    * [メーカー名]は[日付]に[製品名]を発売する
  * そこに抽出対象となる文を当てはめることで情報を抽出する

* あてはめる文は先に、以下のように固有表現認識をしておき、その固有表現のクラスに当てはまった場合だけ情報を抽出する

  ``` example
  <メーカー名>米アップル社</メーカー名>は、<日付>9月13日</日付>に<製品名>iPhone 5</製品名>を発売する。
  ```

* 価格の情報を加えたいとすると、以下のようにパターンは幾通りも考えられる

  ``` example
  [メーカー名]は[日付]に[価格]で[製品名]を発売する
  [メーカー名]は[日付]に[製品名]を[価格]で発売する
  ```

* どちらのパターンを用いても、最初に挙げた文から価格を抽出できない
  * ある出来事を表すパターンは`無数にある`
  * それらをすべて`網羅することは難しい`
  * 機械学習による手法も試されているが、`高い精度で出来事を抽出するのは難しい`タスクとなっている

* もう一つの問題
  * イベント情報抽出技術の有効性が、対象となる分野に依存する
  * 例のイベント情報抽出パターンは、人事異動や災害発生といったイベントの抽出には全く使用できない
  * `分野適応(Domain Adaptation)` と呼ばれる自然言語処理の大きな課題の一つ

* 情報抽出では、分野適応問題の解決に向けて、パターンの半自動的な獲得に関する試み等が行われている

## 2.4 テキストマイニング

### テキストマイニングとは

* テキストを対象とした `データマイニング` 技術
  * 確率・統計的な手法を使って、大量のテキストから有用な情報を引き出す技術の総称

* 対象は構造化されていないテキスト(情報抽出と同様)
  * 言語自体の処理より `役に立つ情報を引き出すこと` に重点が置かれている

* 以下の処理がテキストマイニングの典型例
  * 「お客様の声」を解析
    * そこに含まれる単語を洗い出す
    * その単語を肯定的・否定的な意見に分類する
    * その数を統計処理する

* 広義には、 以下の要素技術を含んだ概念
  * 検索
  * クラスタリング

* 使われる技術
  * 簡単なもの
    * 単語の頻度・分布・相関調査
  * 複雑なもの
    * 情報や固有名詞の抽出
    * データの可視化

* ユーザーの意見・評判・要望の分析
  * ビジネス的にも需要が高い
  * テキストマイニングで特に重視

### テキストマイニングで扱うテキスト

* 例
  * 自由回答のアンケート文
  * コールセンターに寄せられた意見・苦情、顧客とオペレータとのやり取り記録
  * 製品・サービスレビュー
  * Web上のソーシャルメディア
  * カルテや論文の抄録

* ツイッター特有の砕けた表現の正規化、品詞付与、構文解析の技術も研究されている

## 2.5 形態素解析

言語を構成する最小単位である単語を切り出す技術

### 自然言語処理における単語分割の重要性

* 単語は言語を構成する最小単位
  * 文章や文を1単位として扱うよりも正確に内容を捉えられる
  * 文字を1単位とするより意味のある情報を得られる

* 英語はスペースで1単語ごと区切られている
  * 日本語は、文を単語にする処理が容易ではない

* 英語圏で開発された優れた技術、サービスを日本語圏で導入すると、正常に動作しない
  * 単語区切りがスペースなので

* 日本語の自然言語処理において単語分割は非常に重要

### 形態素解析と単語分割

* 形態素解析では、単語分割に加えて品詞付与などの処理を同時に行う
  * 品詞の情報を使うことで単語分割処理の精度が高められる
  * 品詞を付与するには単語区切りの情報が必須となる
  * 互いに依存しあう、鳥と卵の関係

* `品詞付与`
  * 文中の単語が名詞か動詞かといった品詞を分類する処理

### 形態素解析ソフトウェアMeCab

* [公式ウェブサイト](http://taku910.github.io/mecab/)

* [形態素解析の性能比較](https://qiita.com/WaterIsland/items/6f30f0d8904665ac66c8)

* 形態素解析ソフトウェア=形態素解析器

* 以下により高精度な形態素解析を実現する
  * 辞書引きによる高速な単語分割と機械学習

* OSS、ライセンスはトリプルライセンス

``` cmd
MeCab はフリーソフトウェアです．GPL(the GNU General Public License), LGPL(Lesser GNU General Public License), または BSD ライセンスに従って本ソフトウェアを使用,再配布することができます。 詳細は COPYING, GPL, LGPL, BSD各ファイルを参照して下さい．
```

* 形態素解析を行うには、辞書が必要となる
  * 標準的なものには、 `IPA辞書` がある

### MeCabによる形態素解析の実際

* 単語を分割する

  ``` cmd
  mecab -O wakati
  東京オリンピックが決まった
  東京 オリンピック が 決まっ た < 分かち書きされた文
  ```

  `-O` オプションなし > 品詞や付加情報が表示される
  (EOS: End Of Sentence の略、文の終わり)

  ``` cmd
  mecab
  東京オリンピックが決まった
  東京 名詞, 固有名詞, 地域, 一般, *, *, 東京, トウキョウ, トーキョー, ,
  オリンピック 名詞, 一般, *, *, *, *, オリンピック, オリンピック, オリンピック, ,
  が ...
  決まっ 動詞, 自立, 五段・ラ行, 連用タ接続, 決まる, キマッ, キマッ, きまっ/決っ/決まっ
  た ...
  。 記号, 句点, *, *, *, *, 。, 。, 。 , ,
  EOS
  ```

* 付加情報の内容は、使用する辞書によって異なる
  * IPA辞書の場合
    * CSV形式の付加情報(コンマで区切られる)
      * 品詞に関する情報
      * 活用に関する情報
      * 読みに関する情報
      * etc
    ``` format
    表層形\t品詞,品詞細分類1,品詞細分類2,品詞細分類3,活用型,活用形,原形,読み,発音
    ```

  * `*` はその情報がその単語に無関係で辞書に含まれていないことを表す

* 活用形
  * 基本形：べし
  * 未然形：べから
  * 終止形：べし
  * 連用形：べかり
  * 連体形：べかる
  * 已然形：べけれ
  * 命令形：-

* 活用型
  * サ行変格活用、カ行変格活用 etc

### 形態素解析の未知語対策

* 珍しい単語をうまく処理できないことがしばしば問題になる
  * 新しい言葉や人名等　`未知語` は辞書に登録されていない
  * MeCabが正しく認識できない

* MeCabは連続するカタカナを一語とみなす機能を持つ
  * 短いカタカナ語であれば問題なく処理できる

  ``` example
  インターネット
  インターネット  名詞,一般,*,*,*,*,インターネット,インターネット,インターネット
  ```

  ``` example
  ワタシノナマエハタナカデス
  ワタシノナマエハタナカデス      名詞,固有名詞,組織,*,*,*,*
  ```

* しばしば解析に失敗する
  * ひらがなや漢字の未知語
  * カタカナ語の複合名詞

* IPA辞書は新聞記事を基準に編集されている
  * 砕けた表現に弱い

* 失敗例
  * 間違った部分で分割される
  * 単語分割に成功しても、品詞付与や読み付与に失敗する

* 形態素解析の間違いを避ける対策
  * ユーザー辞書に該当の単語を追加することがよく行われている
  * 新しい単語は次々生まれており、そのすべてを辞書に追加し正しく認識させるのはほぼ不可能

* 形態素解析における `未知語対策` は重要な研究トピックになっている
  * KyTea(キューティー、京都テキスト解析ツールキット), JUMAN(ジュマン)

* `mecab-ipadic-neologd` が公開されている
  * Web上の各種言語資源から収集した新語に対応したMeCab用辞書

## 2.6 構造解析の技術

* 文の解釈の `曖昧性`
  * 単語の境界や品詞がわからないことも一種の曖昧性
  * 文の構造の曖昧性

    ``` example
    白い表紙の新しい本

    1. 新しい本があって、その本の表紙が白い
    2. 白い本があって、その本の表紙が新しい
    3. 本があって、その本の表紙が新しくて白い
    ```

* 英語に機械翻訳すると

  ``` example
  1. the new book with the white cover
  2. the white book with the new cover
  3. the book with the white new cover
  ```

* コンピュータが文の構造を正しく解析できれば...
  * 著者の意図をつかみ、正確な処理が可能になる
  * 対話・質問応答システムにおいても、より正確な応答が可能になる

* `構文解析`
  * 文の構造を解析し、コンピュータが利用可能な形の構造に表現する 
    * `係り受け解析`
    * `句構造解析`

### 係り受け構造

* 最も多く利用される表現方法

* `文中の単語が互いにどのような関係になっているか` に着目する
  * 係り受け構造(係り受け木)で表現できる
    * 矢印がさしている単語を `親(主辞, Head)`
    * 矢印が出ている単語を `子(従属語)`
  * 各分には必ず親のない単語が必ず１つ存在し、この単語は文全体の親になる
  * 日本語では原則、親が子より右に存在する
    * 全ての矢印が左から右へとさす
    * 文の親は、文の最後の単語となっている
    * 日本語のような `主辞後置型言語` の特徴

* `ラベルなし係り受け`
  * 矢印だけで示す表現方法
  * 係り受け構造の最もシンプルな形

* `ラベルあり係り受け`
  * 各矢印に対してラベルを付与する表現方法
    * 広く使われている
    * ラベルが単語間の関係を示している(`役割` とも呼ばれる)
  * `表層格`
    * ラベルに主に品詞などを表示する
  * `深層格`
    * 表層格よりもより踏み込んだレベルで単語間の関係を表示する
      * 主格、属格、というラベル

### 係り受け解析

* 係り受け構造を文に自動的に付与する技術
  * NPLの分野で最も広く利用されている技術の１つ

* 以下のような様々な手法がある
  * 左から右へ解析する方法
  * 文全体の係り受けを同時に解析する手法

#### 左から右へ解析する方法

* 日本語の係り受け解析で最も広く利用される方法の１つ

#### 文全体の係り受けを同時に解析する手法

### 句構造解析