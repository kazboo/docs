# サーバーレスコンピューティングにおける次の一手とは

## Google Cloud のサーバーレスコンピューティング

* `App Engineスタンダード`
    - ウェブアプリケーションプラットフォーム

* `Cloud Functions`
    - イベント駆動型の関数

* `Cloud Run`
    - サーバレスコンテナ

## AppEngine

* Designed for web app running web app frameworks like ExpressJS, Flask or Spring.

* php7.2(GA!), GO1.11(GA!), Node10, Java 11(α, new!), Ruby 2.5(α, new!)

* 比較されるサーバーレスの中で最も古い

* 第一世代 から 第二世代ランタイム でメモリ2倍が適用される
    + 価格変わらない！

* F4_HIGHMEM 2048MB 追加

* [App Engineの標準環境](https://cloud.google.com/appengine/docs/standard/?hl=en#instance_classes)


## Cloud Functions

* Designed to run lightweight functions to connect and extend cloud services

* 少量のコードスニペットを書く

* python3.7(GA!), Node8(GA!), Node10(β), Go1.11(GA!), Go1.12(α), Java8(α)

* 最大インスタンス数
    + 関数ごとに設定する > デプロイ時に設定する
    + インピーダンスミスマッチなシナリオに便利
        - フロントエンドとバックエンドのミスマッチが起こらない
        - インピーダンスミスマッチ：システム間の境界にて発生する不整合(ex. オブジェクト指向言語とRDBとのギャップとか)
    ```bash
    $ gcloud beta functions deploy ... --max-instances 5
    ```

* `Serverless VPC Access` (CF & AE)
    + 関数とアプリケーションからVPC内のリソースにアクセス可能(今までできなかった)
    + デプロイ時に設定
    + GCEインスタンスやGCE上にホストされたGoogle Cloud Serivces(e.g. Cloud Memorystore)へのアクセスを許可する
    ```
    gcloud beta functions deploy ... --vpc-connector ...
    ```
    ```
    +-----VPC-----+
    |US Central   | <--+
    |-------------|    |<---[VPC Connector]<---<GCF>
    |US East      | <--|
    +-------------+    |
         |             |
       [VPN]           |
         |             |
    +-------------+    |
    |On-Premises  | <--+
    +-------------+
    ```
    + Your Services running on GCE or GKE
    + 3rd party products running in GCE/GKE(e.g. Databases, Elasticsearch etc)
    + Google services running in GCE(e.g. Cloud Memorystore)
    + Your services running in your own data center

+ Per-Function Identity/関数ごとのアイデンティティ(IAM)
    + プロジェクト内の個々のFunctionsに独自のアイデンティティを持たせる
    + デプロイ時に設定する
    + リソースアクセスに対するきめ細かい制御が可能
    ```
    gcloud beta functions deploy ... --service-account ...
    ```
    ```
    [RoleA]-("w") --Deploy--> <GCF> <--Reads--> <GCS>
    [RoleB]                  [RoleB]             [B]
    ```

+ 新しいリージョン追加
    + US Central(us-central1)
    + US East(us-east1)
    + Belgium(eu-west1)
    + Tokyo(asia-northeast1)
    + `London(eu-west2)`
    + `Hong Kong(asia-east2)`

## Cloud Tasks GA! `WIP`

+ 非同期タスク実行
+ ポイント to ポイントのタスク実行
+ HTTPでのネイティブGCP認証(IAM) new !
+ レート制限再試行ポリシー

## Cloud SCheduer `WIP`

* HTTP認証(IAM)
    + OPEN ID TOKEN
    + Cloud Pub/Subでも可能

## 次の一手は `WIP`

+ サーバーレス
    + ソース主導 (コード)
    + NoOps (クラウドオペレータがやってくれる)
    + 使用量に応じた課金

+ コンテナが登場した
    + コンテナ主導
    + いくらか多くの運用作業
        + GKE大変
    + インスタンス単位の課金

* そしてCloud Run が登場
    + サーバーレスコンテナ
       + サーバーレスコンテナにもちこんだ
       + パッチも必要ない
       + 従量課金制
       + フルマネージもできるし、自社のGKEクラスタでもできる
       + インターネットに公開できる(--allow-unauth)
    
* Dockerコンテナ：サーバレスの場合、小さいほうがいい(=alpine)

* 非常にはやいデプロイ

* インスタンスのConcurrency
    + サーバーレスには新しい
    * マルチスレッドプログラム同様、競合状態への対応が必要

* 高速スケーリング
    + 空いてなかったら起動=コールドスタート
    + ワークロードはバーストあり . minnna douji access. 
    + stateless (svles container). hayaku kidoudekirukedo, reitency cost gataakkunaru (hituyou ijouni takakusinai)
    + time beam 
    + apache bench
    + 10 s
    + デフォルトで1万インスタンス、制限をはずすことはかのう
    + デリート中はコストかからない
    + クロスワードパズルを公開している
1日8億50ｓ00マンリクエスト 

* https://medium.com/google-cloud-jp/serverless-whats-announced-in-next19-4e9cc51a178c